2025-06-23 21:40:45,044 - __main__ - INFO - Starting visibility path planning with grid aligned to building orientation (debug enabled)
2025-06-23 21:40:45,050 - __main__ - INFO - Initial memory usage - Memory usage: 108.80 MB
2025-06-23 21:40:45,051 - __main__ - INFO - Loading geometry data
2025-06-23 21:40:45,051 - __main__ - INFO - Building orientation analysis is enabled
2025-06-23 21:40:45,051 - __main__ - INFO - Debug visualization is enabled
2025-06-23 21:40:45,051 - __main__ - INFO - Before geometry loading - Memory usage: 108.80 MB
2025-06-23 21:40:45,051 - src.data_handler - INFO - Loading geometries from data/geometry.json
2025-06-23 21:40:45,052 - src.data_handler - WARNING - Building building2 has an invalid polygon
2025-06-23 21:40:45,053 - src.data_handler - INFO - Building orientation analysis is enabled
2025-06-23 21:40:45,057 - src.rotation_utils - INFO - Longest edge length: 18.00, angle with north: 90.00 degrees
2025-06-23 21:40:45,057 - src.rotation_utils - INFO - Target angle: 90 degrees
2025-06-23 21:40:45,057 - src.rotation_utils - INFO - Rotation angle needed: 0.00 degrees (clockwise)
2025-06-23 21:40:45,057 - src.rotation_utils - INFO - Rotation center: (50.63920951381602, 26.90398740818468)
2025-06-23 21:40:45,153 - src.data_handler - INFO - Saved orientation information to output/orientation/orientation_info.json
2025-06-23 21:40:45,153 - src.data_handler - INFO - Building orientation: Longest edge at 90.00째, Target angle 90째
2025-06-23 21:40:45,153 - src.data_handler - INFO - Grid alignment: Will use rotation angle of 0.00째 around (50.63920951381602, 26.90398740818468)
2025-06-23 21:40:45,371 - __main__ - INFO - After geometry loading - Memory usage: 165.10 MB
2025-06-23 21:40:45,371 - __main__ - INFO - Building the graph
2025-06-23 21:40:45,371 - __main__ - INFO - Before graph building - Memory usage: 165.10 MB
2025-06-23 21:40:45,371 - src.graph_builder - INFO - Building grid graph
2025-06-23 21:40:45,371 - src.graph_builder - INFO - Grid will be aligned with building orientation (rotated by -0.00째)
2025-06-23 21:40:45,389 - src.graph_builder - INFO - Generated 193 grid points
2025-06-23 21:40:45,962 - src.graph_builder - WARNING - The generated graph is not connected.
2025-06-23 21:40:45,963 - src.graph_builder - INFO - Created graph with 193 nodes and 1704 edges
2025-06-23 21:40:45,963 - __main__ - INFO - After graph building - Memory usage: 165.72 MB
2025-06-23 21:40:45,963 - __main__ - INFO - Analyzing visibility with normal vector approach
2025-06-23 21:40:45,963 - __main__ - INFO - Before visibility analysis - Memory usage: 165.72 MB
2025-06-23 21:40:45,963 - src.visibility_analyzer - INFO - Using 12 CPU cores for visibility analysis
2025-06-23 21:40:45,963 - src.visibility_analyzer - INFO - Using touch threshold of 0.1 meters
2025-06-23 21:40:45,963 - src.visibility_analyzer - INFO - Analyzing visibility
2025-06-23 21:40:45,963 - src.visibility_analyzer - INFO - Before segment creation - Memory usage: 165.72 MB
2025-06-23 21:40:45,977 - src.visibility_analyzer - INFO - Created 90 building segments with normal vectors
2025-06-23 21:40:45,977 - src.visibility_analyzer - INFO - Calculating edge-segment visibility using normal vector approach (parallelized)
2025-06-23 21:40:45,977 - src.visibility_analyzer - INFO - Before edge-segment visibility calculation - Memory usage: 165.72 MB
2025-06-23 21:40:45,978 - src.visibility_analyzer - INFO - Dividing 90 segments into 12 chunks for parallel processing
2025-06-23 21:40:47,680 - src.visibility_analyzer - INFO - After edge-segment visibility calculation - Memory usage: 170.85 MB
2025-06-23 21:40:47,680 - src.visibility_analyzer - INFO - Calculating particle-based visibility using normal vector approach (parallelized)
2025-06-23 21:40:47,680 - src.visibility_analyzer - INFO - Before particle visibility calculation - Memory usage: 170.85 MB
2025-06-23 21:40:47,680 - src.visibility_analyzer - INFO - Dividing 1704 edges into 12 chunks for parallel processing
2025-06-23 21:41:22,036 - src.visibility_analyzer - INFO - After particle visibility calculation - Memory usage: 171.85 MB
2025-06-23 21:41:22,039 - src.visibility_analyzer - INFO - Saved segment visibility to output/visibility/segment_visibility.csv
2025-06-23 21:41:22,040 - src.visibility_analyzer - INFO - Saved edge visibility to output/visibility/edge_visibility.csv
2025-06-23 21:41:22,040 - __main__ - INFO - After visibility analysis - Memory usage: 171.97 MB
2025-06-23 21:41:22,040 - __main__ - INFO - Creating thesis plots
2025-06-23 21:41:22,040 - __main__ - INFO - Creating thesis plots
2025-06-23 21:41:22,040 - src.graph_builder - INFO - Building original (non-rotated) grid graph for thesis plots
2025-06-23 21:41:22,704 - src.graph_builder - WARNING - The generated graph is not connected.
2025-06-23 21:41:22,705 - src.graph_builder - INFO - Created original graph with 193 nodes and 1704 edges
2025-06-23 21:41:22,705 - src.graph_builder - INFO - Building rotated grid graph for thesis plots
2025-06-23 21:41:23,364 - src.graph_builder - WARNING - The generated graph is not connected.
2025-06-23 21:41:23,364 - src.graph_builder - INFO - Created rotated graph with 193 nodes and 1704 edges
2025-06-23 21:41:23,364 - src.visualizer - INFO - Creating thesis plots
2025-06-23 21:41:24,290 - src.visualizer - INFO - Saved thesis plot 1 to output/thesis_plots/1_building_obstacles_footprint_20250623_214123.png
2025-06-23 21:41:25,450 - src.visualizer - INFO - Saved thesis plot 2 to output/thesis_plots/2_building_with_segments_20250623_214124.png
2025-06-23 21:41:26,645 - src.visualizer - INFO - Saved thesis plot 3 to output/thesis_plots/3_building_original_graph_20250623_214125.png
2025-06-23 21:41:27,867 - src.visualizer - INFO - Saved thesis plot 4 to output/thesis_plots/4_building_rotated_graph_20250623_214126.png
2025-06-23 21:41:27,867 - __main__ - INFO - Creating visibility heatmaps (basic)
2025-06-23 21:41:27,867 - src.visualizer - INFO - Creating visibility heatmaps
2025-06-23 21:41:27,871 - src.visualizer - INFO - Edge visibility range: 0 to 7 segments
2025-06-23 21:41:29,598 - src.visualizer - INFO - Saved edge visibility heatmap to output/visibility_heatmaps/1_edge_visibility_heatmap_20250623_214128.png
2025-06-23 21:41:29,601 - src.visualizer - INFO - Segment visibility range: 0 to 52 edges
2025-06-23 21:41:30,804 - src.visualizer - INFO - Saved segment visibility heatmap to output/visibility_heatmaps/2_segment_visibility_heatmap_20250623_214129.png
2025-06-23 21:41:30,808 - src.visualizer - INFO - Edge VRF range: 0.0000 to 0.7500
2025-06-23 21:41:32,695 - src.visualizer - INFO - Saved edge VRF heatmap to output/visibility_heatmaps/3_edge_vrf_heatmap_20250623_214131.png
2025-06-23 21:41:32,695 - __main__ - INFO - Running path optimization
2025-06-23 21:41:32,695 - __main__ - INFO - Before optimization - Memory usage: 358.82 MB
2025-06-23 21:41:32,695 - __main__ - INFO - Running garbage collection before optimization
2025-06-23 21:41:32,761 - src.optimizer - INFO - Setting up optimization model
2025-06-23 21:41:32,762 - src.optimizer - INFO - Before optimization model creation - Memory usage: 208.58 MB
2025-06-23 21:41:32,764 - gurobipy - INFO - Set parameter Username
2025-06-23 21:41:32,764 - gurobipy - INFO - Set parameter LicenseID to value 2654881
2025-06-23 21:41:32,765 - gurobipy - INFO - Academic license - for non-commercial use only - expires 2026-04-21
2025-06-23 21:41:32,766 - gurobipy - INFO - Set parameter LazyConstraints to value 1
2025-06-23 21:41:32,767 - gurobipy - INFO - Set parameter MIPGap to value 0,0001
2025-06-23 21:41:32,773 - src.optimizer - WARNING - Segment 3 has no visible edges
2025-06-23 21:41:32,774 - src.optimizer - WARNING - Segment 14 has no visible edges
2025-06-23 21:41:32,774 - src.optimizer - WARNING - Segment 15 has no visible edges
2025-06-23 21:41:32,774 - src.optimizer - WARNING - Segment 18 has no visible edges
2025-06-23 21:41:32,774 - src.optimizer - WARNING - Segment 19 has no visible edges
2025-06-23 21:41:32,774 - src.optimizer - WARNING - Segment 22 has no visible edges
2025-06-23 21:41:32,774 - src.optimizer - WARNING - Segment 26 has no visible edges
2025-06-23 21:41:32,774 - src.optimizer - WARNING - Segment 29 has no visible edges
2025-06-23 21:41:32,774 - src.optimizer - WARNING - Segment 31 has no visible edges
2025-06-23 21:41:32,774 - src.optimizer - WARNING - Segment 34 has no visible edges
2025-06-23 21:41:32,774 - src.optimizer - WARNING - Segment 37 has no visible edges
2025-06-23 21:41:32,774 - src.optimizer - WARNING - Segment 38 has no visible edges
2025-06-23 21:41:32,774 - src.optimizer - WARNING - Segment 41 has no visible edges
2025-06-23 21:41:32,775 - src.optimizer - WARNING - Segment 42 has no visible edges
2025-06-23 21:41:32,781 - src.optimizer - INFO - Adding constraints for tie points: [98]
2025-06-23 21:41:32,781 - src.optimizer - INFO - Added tie point constraints for node 98
2025-06-23 21:41:32,781 - src.optimizer - INFO - Using original subtour elimination constraints
2025-06-23 21:41:34,525 - src.optimizer - INFO - Added 156832 subtour elimination constraints
2025-06-23 21:41:34,525 - src.optimizer - INFO - After optimization model setup - Memory usage: 229.08 MB
2025-06-23 21:41:34,525 - src.optimizer - INFO - Solving optimization model with progress monitoring
2025-06-23 21:41:34,546 - gurobipy - INFO - Gurobi Optimizer version 12.0.1 build v12.0.1rc0 (linux64 - "Ubuntu 22.04.5 LTS")
2025-06-23 21:41:34,546 - gurobipy - INFO - 
2025-06-23 21:41:34,546 - gurobipy - INFO - CPU model: 12th Gen Intel(R) Core(TM) i5-12450H, instruction set [SSE2|AVX|AVX2]
2025-06-23 21:41:34,546 - gurobipy - INFO - Thread count: 12 physical cores, 12 logical processors, using up to 12 threads
2025-06-23 21:41:34,546 - gurobipy - INFO - 
2025-06-23 21:41:34,546 - gurobipy - INFO - Non-default parameters:
2025-06-23 21:41:34,546 - gurobipy - INFO - LazyConstraints  1
2025-06-23 21:41:34,546 - gurobipy - INFO - 
2025-06-23 21:41:34,546 - gurobipy - INFO - Optimize a model with 157103 rows, 1704 columns and 331323 nonzeros
2025-06-23 21:41:34,548 - gurobipy - INFO - Model fingerprint: 0x67dae4d3
2025-06-23 21:41:34,548 - gurobipy - INFO - Variable types: 0 continuous, 1704 integer (1704 binary)
2025-06-23 21:41:34,548 - gurobipy - INFO - Coefficient statistics:
2025-06-23 21:41:34,548 - gurobipy - INFO -   Matrix range     [1e+00, 1e+00]
2025-06-23 21:41:34,548 - gurobipy - INFO -   Objective range  [1e+01, 2e+07]
2025-06-23 21:41:34,548 - gurobipy - INFO -   Bounds range     [1e+00, 1e+00]
2025-06-23 21:41:34,548 - gurobipy - INFO -   RHS range        [1e+00, 2e+00]
2025-06-23 21:41:34,582 - gurobipy - INFO - Presolve removed 152125 rows and 0 columns
2025-06-23 21:41:34,583 - gurobipy - INFO - Presolve time: 0.02s
2025-06-23 21:41:34,583 - gurobipy - INFO - Presolved: 4978 rows, 1704 columns, 27075 nonzeros
2025-06-23 21:41:34,586 - gurobipy - INFO - Variable types: 0 continuous, 1704 integer (1704 binary)
2025-06-23 21:41:34,592 - gurobipy - INFO - Performing another presolve...
2025-06-23 21:41:34,614 - gurobipy - INFO - Presolve removed 18 rows and 0 columns
2025-06-23 21:41:34,615 - gurobipy - INFO - Presolve time: 0.02s
2025-06-23 21:41:34,625 - gurobipy - INFO - 
2025-06-23 21:41:34,626 - gurobipy - INFO - Root relaxation: objective 5.471986e+02, 79 iterations, 0.00 seconds (0.00 work units)
2025-06-23 21:41:34,632 - gurobipy - INFO - 
2025-06-23 21:41:34,632 - gurobipy - INFO -     Nodes    |    Current Node    |     Objective Bounds      |     Work
2025-06-23 21:41:34,632 - gurobipy - INFO -  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
2025-06-23 21:41:34,632 - gurobipy - INFO - 
2025-06-23 21:41:34,632 - gurobipy - INFO -      0     0  547.19857    0   57          -  547.19857      -     -    0s
2025-06-23 21:41:34,662 - gurobipy - INFO -      0     0  783.72339    0   65          -  783.72339      -     -    0s
2025-06-23 21:41:34,667 - gurobipy - INFO -      0     0  847.72291    0   63          -  847.72291      -     -    0s
2025-06-23 21:41:34,681 - gurobipy - INFO -      0     0 1011.81522    0   47          - 1011.81522      -     -    0s
2025-06-23 21:41:34,687 - gurobipy - INFO -      0     0 1013.76629    0   37          - 1013.76629      -     -    0s
2025-06-23 21:41:34,705 - gurobipy - INFO -      0     0 1049.17041    0   33          - 1049.17041      -     -    0s
2025-06-23 21:41:34,711 - gurobipy - INFO -      0     0 1054.69065    0   62          - 1054.69065      -     -    0s
2025-06-23 21:41:34,733 - gurobipy - INFO -      0     0 1055.97727    0   40          - 1055.97727      -     -    0s
2025-06-23 21:41:34,738 - gurobipy - INFO -      0     0 1056.04072    0   32          - 1056.04072      -     -    0s
2025-06-23 21:41:34,749 - gurobipy - INFO -      0     0 1059.30384    0   31          - 1059.30384      -     -    0s
2025-06-23 21:41:34,762 - gurobipy - INFO -      0     0 1062.04155    0   28          - 1062.04155      -     -    0s
2025-06-23 21:41:34,767 - gurobipy - INFO -      0     0 1062.39716    0   24          - 1062.39716      -     -    0s
2025-06-23 21:41:34,775 - gurobipy - INFO -      0     0 1063.38176    0   27          - 1063.38176      -     -    0s
2025-06-23 21:41:34,780 - gurobipy - INFO -      0     0 1063.58229    0   30          - 1063.58229      -     -    0s
2025-06-23 21:41:34,783 - gurobipy - INFO -      0     0 1063.61350    0   38          - 1063.61350      -     -    0s
2025-06-23 21:41:34,795 - gurobipy - INFO -      0     0 1064.93798    0   42          - 1064.93798      -     -    0s
2025-06-23 21:41:34,801 - gurobipy - INFO -      0     0 1065.18989    0   28          - 1065.18989      -     -    0s
2025-06-23 21:41:34,819 - gurobipy - INFO -      0     0 1065.82404    0   26          - 1065.82404      -     -    0s
2025-06-23 21:41:34,897 - gurobipy - INFO -      0     2 1070.52326    0   56          - 1070.52326      -     -    0s
2025-06-23 21:41:39,161 - gurobipy - INFO - * 4943  4330              34    1609.7456928 1483.76104  7.83%   9.6    4s
2025-06-23 21:41:39,161 - src.optimizer - INFO - Optimization progress: 8.49% gap after 4.6 seconds
2025-06-23 21:41:39,161 - src.optimizer - INFO - Gap improved by inf% to 8.49%
2025-06-23 21:41:39,559 - gurobipy - INFO -   5272  4354 1581.52310   46   80 1609.74569 1503.70380  6.59%  11.5    5s
2025-06-23 21:41:39,796 - gurobipy - INFO - * 5575  4161              44    1579.8792167 1516.94669  3.98%  12.3    5s
2025-06-23 21:41:39,797 - src.optimizer - INFO - Gap improved by 1.97% to 4.15%
2025-06-23 21:41:40,190 - gurobipy - INFO - * 6273  3526              37    1578.8125578 1556.09225  1.44%  14.6    5s
2025-06-23 21:41:40,234 - gurobipy - INFO - 
2025-06-23 21:41:40,234 - gurobipy - INFO - Cutting planes:
2025-06-23 21:41:40,234 - gurobipy - INFO -   Gomory: 17
2025-06-23 21:41:40,234 - gurobipy - INFO -   Lift-and-project: 43
2025-06-23 21:41:40,234 - gurobipy - INFO -   Cover: 21
2025-06-23 21:41:40,235 - gurobipy - INFO -   MIR: 33
2025-06-23 21:41:40,235 - gurobipy - INFO -   StrongCG: 2
2025-06-23 21:41:40,235 - gurobipy - INFO -   Flow cover: 86
2025-06-23 21:41:40,235 - gurobipy - INFO -   GUB cover: 4
2025-06-23 21:41:40,235 - gurobipy - INFO -   Inf proof: 3
2025-06-23 21:41:40,235 - gurobipy - INFO -   Zero half: 45
2025-06-23 21:41:40,236 - gurobipy - INFO -   RLT: 17
2025-06-23 21:41:40,236 - gurobipy - INFO -   Lazy constraints: 5
2025-06-23 21:41:40,238 - gurobipy - INFO - 
2025-06-23 21:41:40,238 - gurobipy - INFO - Explored 6572 nodes (94974 simplex iterations) in 5.69 seconds (6.81 work units)
2025-06-23 21:41:40,238 - gurobipy - INFO - Thread count was 12 (of 12 available processors)
2025-06-23 21:41:40,238 - gurobipy - INFO - 
2025-06-23 21:41:40,238 - gurobipy - INFO - Solution count 3: 1578.81 1579.88 1609.75 
2025-06-23 21:41:40,239 - gurobipy - INFO - 
2025-06-23 21:41:40,239 - gurobipy - INFO - Optimal solution found (tolerance 1.00e-04)
2025-06-23 21:41:40,240 - gurobipy - INFO - Best objective 1.578812557796e+03, best bound 1.578812557796e+03, gap 0.0000%
2025-06-23 21:41:40,241 - gurobipy - INFO - 
2025-06-23 21:41:40,241 - gurobipy - INFO - User-callback calls 16000, time in user-callback 0.10 sec
2025-06-23 21:41:40,245 - src.optimizer - INFO - Optimization successful, selected 53 edges
2025-06-23 21:41:40,245 - src.optimizer - INFO - After optimization model solving - Memory usage: 467.83 MB
2025-06-23 21:41:40,245 - __main__ - INFO - After optimization - Memory usage: 467.83 MB
2025-06-23 21:41:40,247 - __main__ - INFO - Added starting node at the end to close the tour
2025-06-23 21:41:40,247 - __main__ - INFO - Saved tour path with 54 points to output/path/path.txt
2025-06-23 21:41:40,247 - __main__ - INFO - Tour visits 51 unique nodes with 53 total steps
2025-06-23 21:41:40,247 - __main__ - INFO - Tour includes 2 revisited nodes (tie points)
2025-06-23 21:41:40,247 - __main__ - INFO - Creating VRF heatmap with optimized path overlay
2025-06-23 21:41:40,247 - src.visualizer - INFO - Creating visibility heatmaps
2025-06-23 21:41:40,251 - src.visualizer - INFO - Edge visibility range: 0 to 7 segments
2025-06-23 21:41:42,014 - src.visualizer - INFO - Saved edge visibility heatmap to output/visibility_heatmaps/1_edge_visibility_heatmap_20250623_214140.png
2025-06-23 21:41:42,017 - src.visualizer - INFO - Segment visibility range: 0 to 52 edges
2025-06-23 21:41:43,245 - src.visualizer - INFO - Saved segment visibility heatmap to output/visibility_heatmaps/2_segment_visibility_heatmap_20250623_214142.png
2025-06-23 21:41:43,249 - src.visualizer - INFO - Edge VRF range: 0.0000 to 0.7500
2025-06-23 21:41:45,230 - src.visualizer - INFO - Saved edge VRF heatmap to output/visibility_heatmaps/3_edge_vrf_heatmap_20250623_214143.png
2025-06-23 21:41:45,234 - src.visualizer - INFO - VRF with path overlay - VRF range: 0.0000 to 0.7500
2025-06-23 21:41:45,702 - __main__ - ERROR - Error during execution: draw_networkx_nodes() got an unexpected keyword argument 'zorder'
Traceback (most recent call last):
  File "/home/mo/thesis/My_Thesis/Versions/thesis_v24/main.py", line 519, in main
    visualizer.create_visibility_heatmaps(G, building, obstacles, segments, edge_visibility, segment_visibility, vrf, selected_edges)
  File "/home/mo/thesis/My_Thesis/Versions/thesis_v24/src/visualizer.py", line 400, in create_visibility_heatmaps
    self._plot_vrf_with_optimized_path(G, building, obstacles, vrf, selected_edges, heatmaps_dir)
  File "/home/mo/thesis/My_Thesis/Versions/thesis_v24/src/visualizer.py", line 248, in _plot_vrf_with_optimized_path
    nx.draw_networkx_nodes(G, pos, node_color='lightgray', node_size=20,
TypeError: draw_networkx_nodes() got an unexpected keyword argument 'zorder'
2025-06-23 21:41:45,704 - src.visualizer - INFO - Creating visualization
2025-06-23 21:41:48,149 - src.visualizer - INFO - Saved plot to output/plots/result_plot_20250623_214145.png
2025-06-23 21:42:08,215 - __main__ - INFO - Disposed Gurobi optimization model
2025-06-23 21:42:08,216 - __main__ - INFO - Before cleanup - Memory usage: 517.36 MB
2025-06-23 21:42:08,300 - __main__ - INFO - After cleanup - Memory usage: 509.42 MB
