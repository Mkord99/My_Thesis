2025-06-23 22:03:45,289 - __main__ - INFO - Starting visibility path planning with normal vector approach
2025-06-23 22:03:45,295 - __main__ - INFO - Initial memory usage - Memory usage: 108.58 MB
2025-06-23 22:03:45,295 - __main__ - INFO - Loading geometry data
2025-06-23 22:03:45,295 - __main__ - INFO - Building orientation analysis is disabled
2025-06-23 22:03:45,296 - __main__ - INFO - Before geometry loading - Memory usage: 108.58 MB
2025-06-23 22:03:45,296 - src.data_handler - INFO - Loading geometries from data/geometry.json
2025-06-23 22:03:45,296 - src.data_handler - WARNING - Building building2 has an invalid polygon
2025-06-23 22:03:45,297 - src.data_handler - INFO - Building orientation analysis is disabled
2025-06-23 22:03:45,297 - __main__ - INFO - After geometry loading - Memory usage: 109.70 MB
2025-06-23 22:03:45,297 - __main__ - INFO - Building the graph
2025-06-23 22:03:45,297 - __main__ - INFO - Before graph building - Memory usage: 109.70 MB
2025-06-23 22:03:45,297 - src.graph_builder - INFO - Building grid graph
2025-06-23 22:03:45,325 - src.graph_builder - INFO - Generated 193 grid points
2025-06-23 22:03:45,897 - src.graph_builder - WARNING - The generated graph is not connected.
2025-06-23 22:03:45,897 - src.graph_builder - INFO - Created graph with 193 nodes and 1700 edges
2025-06-23 22:03:45,897 - __main__ - INFO - After graph building - Memory usage: 110.45 MB
2025-06-23 22:03:45,898 - __main__ - INFO - Analyzing visibility with normal vector approach
2025-06-23 22:03:45,898 - __main__ - INFO - Before visibility analysis - Memory usage: 110.45 MB
2025-06-23 22:03:45,898 - src.visibility_analyzer - INFO - Using 12 CPU cores for visibility analysis
2025-06-23 22:03:45,898 - src.visibility_analyzer - INFO - Using touch threshold of 0.1 meters
2025-06-23 22:03:45,898 - src.visibility_analyzer - INFO - Analyzing visibility
2025-06-23 22:03:45,898 - src.visibility_analyzer - INFO - Before segment creation - Memory usage: 110.45 MB
2025-06-23 22:03:45,911 - src.visibility_analyzer - INFO - Created 83 building segments with normal vectors
2025-06-23 22:03:45,911 - src.visibility_analyzer - INFO - Calculating edge-segment visibility using normal vector approach (parallelized)
2025-06-23 22:03:45,911 - src.visibility_analyzer - INFO - Before edge-segment visibility calculation - Memory usage: 110.45 MB
2025-06-23 22:03:45,911 - src.visibility_analyzer - INFO - Dividing 83 segments into 12 chunks for parallel processing
2025-06-23 22:03:47,375 - src.visibility_analyzer - INFO - After edge-segment visibility calculation - Memory usage: 115.45 MB
2025-06-23 22:03:47,375 - src.visibility_analyzer - INFO - Calculating particle-based visibility using normal vector approach (parallelized)
2025-06-23 22:03:47,375 - src.visibility_analyzer - INFO - Before particle visibility calculation - Memory usage: 115.45 MB
2025-06-23 22:03:47,375 - src.visibility_analyzer - INFO - Dividing 1700 edges into 12 chunks for parallel processing
2025-06-23 22:04:18,285 - src.visibility_analyzer - INFO - After particle visibility calculation - Memory usage: 116.45 MB
2025-06-23 22:04:18,288 - src.visibility_analyzer - INFO - Saved segment visibility to output/visibility/segment_visibility.csv
2025-06-23 22:04:18,289 - src.visibility_analyzer - INFO - Saved edge visibility to output/visibility/edge_visibility.csv
2025-06-23 22:04:18,290 - __main__ - INFO - After visibility analysis - Memory usage: 116.45 MB
2025-06-23 22:04:18,290 - __main__ - INFO - Creating thesis plots
2025-06-23 22:04:18,290 - __main__ - INFO - Creating thesis plots
2025-06-23 22:04:18,290 - src.graph_builder - INFO - Building original (non-rotated) grid graph for thesis plots
2025-06-23 22:04:18,975 - src.graph_builder - WARNING - The generated graph is not connected.
2025-06-23 22:04:18,975 - src.graph_builder - INFO - Created original graph with 193 nodes and 1700 edges
2025-06-23 22:04:18,975 - src.visualizer - INFO - Creating thesis plots
2025-06-23 22:04:19,950 - src.visualizer - INFO - Saved thesis plot 1 to output/thesis_plots/1_building_obstacles_footprint_20250623_220419.png
2025-06-23 22:04:21,116 - src.visualizer - INFO - Saved thesis plot 2 to output/thesis_plots/2_building_with_segments_20250623_220420.png
2025-06-23 22:04:22,307 - src.visualizer - INFO - Saved thesis plot 3 to output/thesis_plots/3_building_original_graph_20250623_220421.png
2025-06-23 22:04:22,307 - __main__ - INFO - Creating visibility heatmaps (basic)
2025-06-23 22:04:22,307 - src.visualizer - INFO - Creating visibility heatmaps
2025-06-23 22:04:22,310 - src.visualizer - INFO - Edge visibility range: 0 to 13 segments
2025-06-23 22:04:24,041 - src.visualizer - INFO - Saved edge visibility heatmap to output/visibility_heatmaps/1_edge_visibility_heatmap_20250623_220422.png
2025-06-23 22:04:24,045 - src.visualizer - INFO - Segment visibility range: 0 to 73 edges
2025-06-23 22:04:25,194 - src.visualizer - INFO - Saved segment visibility heatmap to output/visibility_heatmaps/2_segment_visibility_heatmap_20250623_220424.png
2025-06-23 22:04:25,197 - src.visualizer - INFO - Edge VRF range: 0.0000 to 1.2500
2025-06-23 22:04:27,123 - src.visualizer - INFO - Saved edge VRF heatmap to output/visibility_heatmaps/3_edge_vrf_heatmap_20250623_220425.png
2025-06-23 22:04:27,123 - __main__ - INFO - Running path optimization
2025-06-23 22:04:27,123 - __main__ - INFO - Before optimization - Memory usage: 338.98 MB
2025-06-23 22:04:27,123 - __main__ - INFO - Running garbage collection before optimization
2025-06-23 22:04:27,185 - src.optimizer - INFO - Setting up optimization model
2025-06-23 22:04:27,186 - src.optimizer - INFO - Before optimization model creation - Memory usage: 188.75 MB
2025-06-23 22:04:27,186 - gurobipy - INFO - Set parameter Username
2025-06-23 22:04:27,186 - gurobipy - INFO - Set parameter LicenseID to value 2654881
2025-06-23 22:04:27,187 - gurobipy - INFO - Academic license - for non-commercial use only - expires 2026-04-21
2025-06-23 22:04:27,187 - gurobipy - INFO - Set parameter LazyConstraints to value 1
2025-06-23 22:04:27,187 - gurobipy - INFO - Set parameter MIPGap to value 0,0001
2025-06-23 22:04:27,192 - src.optimizer - WARNING - Segment 6 has no visible edges
2025-06-23 22:04:27,193 - src.optimizer - WARNING - Segment 26 has no visible edges
2025-06-23 22:04:27,194 - src.optimizer - WARNING - Segment 33 has no visible edges
2025-06-23 22:04:27,194 - src.optimizer - WARNING - Segment 37 has no visible edges
2025-06-23 22:04:27,201 - src.optimizer - INFO - No tie points specified in config
2025-06-23 22:04:27,201 - src.optimizer - INFO - Using original subtour elimination constraints
2025-06-23 22:04:28,931 - src.optimizer - INFO - Added 156472 subtour elimination constraints
2025-06-23 22:04:28,931 - src.optimizer - INFO - After optimization model setup - Memory usage: 209.62 MB
2025-06-23 22:04:28,931 - src.optimizer - INFO - Solving optimization model with progress monitoring
2025-06-23 22:04:28,948 - gurobipy - INFO - Gurobi Optimizer version 12.0.1 build v12.0.1rc0 (linux64 - "Ubuntu 22.04.5 LTS")
2025-06-23 22:04:28,948 - gurobipy - INFO - 
2025-06-23 22:04:28,948 - gurobipy - INFO - CPU model: 12th Gen Intel(R) Core(TM) i5-12450H, instruction set [SSE2|AVX|AVX2]
2025-06-23 22:04:28,948 - gurobipy - INFO - Thread count: 12 physical cores, 12 logical processors, using up to 12 threads
2025-06-23 22:04:28,948 - gurobipy - INFO - 
2025-06-23 22:04:28,948 - gurobipy - INFO - Non-default parameters:
2025-06-23 22:04:28,948 - gurobipy - INFO - LazyConstraints  1
2025-06-23 22:04:28,948 - gurobipy - INFO - 
2025-06-23 22:04:28,948 - gurobipy - INFO - Optimize a model with 156744 rows, 1700 columns and 331425 nonzeros
2025-06-23 22:04:28,950 - gurobipy - INFO - Model fingerprint: 0xd4125f52
2025-06-23 22:04:28,950 - gurobipy - INFO - Variable types: 0 continuous, 1700 integer (1700 binary)
2025-06-23 22:04:28,951 - gurobipy - INFO - Coefficient statistics:
2025-06-23 22:04:28,951 - gurobipy - INFO -   Matrix range     [1e+00, 1e+00]
2025-06-23 22:04:28,951 - gurobipy - INFO -   Objective range  [6e+00, 2e+07]
2025-06-23 22:04:28,951 - gurobipy - INFO -   Bounds range     [1e+00, 1e+00]
2025-06-23 22:04:28,951 - gurobipy - INFO -   RHS range        [1e+00, 2e+00]
2025-06-23 22:04:28,984 - gurobipy - INFO - Presolve removed 151786 rows and 0 columns
2025-06-23 22:04:28,984 - gurobipy - INFO - Presolve time: 0.02s
2025-06-23 22:04:28,984 - gurobipy - INFO - Presolved: 4958 rows, 1700 columns, 27857 nonzeros
2025-06-23 22:04:28,985 - gurobipy - INFO - Variable types: 0 continuous, 1700 integer (1700 binary)
2025-06-23 22:04:28,990 - gurobipy - INFO - Performing another presolve...
2025-06-23 22:04:29,012 - gurobipy - INFO - Presolve removed 21 rows and 0 columns
2025-06-23 22:04:29,012 - gurobipy - INFO - Presolve time: 0.02s
2025-06-23 22:04:29,024 - gurobipy - INFO - 
2025-06-23 22:04:29,024 - gurobipy - INFO - Root relaxation: objective 3.132438e+02, 51 iterations, 0.00 seconds (0.00 work units)
2025-06-23 22:04:29,028 - gurobipy - INFO - 
2025-06-23 22:04:29,028 - gurobipy - INFO -     Nodes    |    Current Node    |     Objective Bounds      |     Work
2025-06-23 22:04:29,028 - gurobipy - INFO -  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
2025-06-23 22:04:29,028 - gurobipy - INFO - 
2025-06-23 22:04:29,029 - gurobipy - INFO -      0     0  313.24384    0   38          -  313.24384      -     -    0s
2025-06-23 22:04:29,056 - gurobipy - INFO -      0     0  433.25626    0   52          -  433.25626      -     -    0s
2025-06-23 22:04:29,061 - gurobipy - INFO -      0     0  435.19911    0   52          -  435.19911      -     -    0s
2025-06-23 22:04:29,074 - gurobipy - INFO -      0     0  538.33542    0   68          -  538.33542      -     -    0s
2025-06-23 22:04:29,079 - gurobipy - INFO -      0     0  547.87731    0   66          -  547.87731      -     -    0s
2025-06-23 22:04:29,100 - gurobipy - INFO -      0     0  600.59135    0   23          -  600.59135      -     -    0s
2025-06-23 22:04:29,107 - gurobipy - INFO -      0     0  606.96875    0   40          -  606.96875      -     -    0s
2025-06-23 22:04:29,128 - gurobipy - INFO -      0     0  620.74802    0    7          -  620.74802      -     -    0s
2025-06-23 22:04:29,140 - gurobipy - INFO -      0     0  629.02735    0   15          -  629.02735      -     -    0s
2025-06-23 22:04:29,149 - gurobipy - INFO -      0     0  633.98171    0   45          -  633.98171      -     -    0s
2025-06-23 22:04:29,152 - gurobipy - INFO -      0     0  634.06636    0   50          -  634.06636      -     -    0s
2025-06-23 22:04:29,163 - gurobipy - INFO -      0     0  638.02501    0   38          -  638.02501      -     -    0s
2025-06-23 22:04:29,178 - gurobipy - INFO -      0     0  640.75424    0   44          -  640.75424      -     -    0s
2025-06-23 22:04:29,194 - gurobipy - INFO -      0     0  642.23364    0   38          -  642.23364      -     -    0s
2025-06-23 22:04:29,202 - gurobipy - INFO -      0     0  642.28092    0   53          -  642.28092      -     -    0s
2025-06-23 22:04:29,212 - gurobipy - INFO -      0     0  643.57963    0   44          -  643.57963      -     -    0s
2025-06-23 22:04:29,225 - gurobipy - INFO -      0     0  644.06725    0   45          -  644.06725      -     -    0s
2025-06-23 22:04:29,243 - gurobipy - INFO -      0     0  644.18916    0   38          -  644.18916      -     -    0s
2025-06-23 22:04:29,264 - gurobipy - INFO -      0     0  645.67489    0   38          -  645.67489      -     -    0s
2025-06-23 22:04:29,326 - gurobipy - INFO -      0     2  658.05575    0   46          -  658.05575      -     -    0s
2025-06-23 22:04:29,967 - gurobipy - INFO - * 3453  2984             154    1901.0972779  703.21105  63.0%   8.8    1s
2025-06-23 22:04:29,967 - src.optimizer - INFO - Optimization progress: 170.35% gap after 1.0 seconds
2025-06-23 22:04:29,967 - src.optimizer - INFO - Gap improved by inf% to 170.35%
2025-06-23 22:04:30,013 - gurobipy - INFO - H 3484  2894                    1718.0882825  703.21105  59.1%   8.8    1s
2025-06-23 22:04:30,013 - src.optimizer - INFO - Gap improved by 26.02% to 144.32%
2025-06-23 22:04:30,014 - gurobipy - INFO - H 3490  2785                    1567.6899375  703.21105  55.1%   8.8    1s
2025-06-23 22:04:30,015 - src.optimizer - INFO - Gap improved by 21.39% to 122.93%
2025-06-23 22:04:30,016 - gurobipy - INFO - H 3503  2531                    1432.8330049  703.21105  50.9%   8.8    1s
2025-06-23 22:04:30,016 - src.optimizer - INFO - Gap improved by 19.18% to 103.76%
2025-06-23 22:04:30,066 - gurobipy - INFO - H 3673  2457                    1294.1673982  703.21105  45.7%   8.9    1s
2025-06-23 22:04:30,066 - src.optimizer - INFO - Gap improved by 19.72% to 84.04%
2025-06-23 22:04:30,070 - gurobipy - INFO - H 3733  2413                    1278.0148540  703.21105  45.0%   8.9    1s
2025-06-23 22:04:30,071 - src.optimizer - INFO - Gap improved by 2.30% to 81.74%
2025-06-23 22:04:30,082 - gurobipy - INFO - H 3765  2295                    1221.1262027  703.21105  42.4%   8.9    1s
2025-06-23 22:04:30,083 - gurobipy - INFO - H 3765  2290                    1218.9928628  703.21105  42.3%   8.9    1s
2025-06-23 22:04:30,142 - src.optimizer - INFO - Gap improved by 8.39% to 73.35%
2025-06-23 22:04:30,181 - src.optimizer - INFO - Gap improved by 1.16% to 72.19%
2025-06-23 22:04:30,217 - src.optimizer - INFO - Gap improved by 10.55% to 61.17%
2025-06-23 22:04:30,230 - src.optimizer - INFO - Gap improved by 2.62% to 58.55%
2025-06-23 22:04:30,288 - src.optimizer - INFO - Gap improved by 3.64% to 54.57%
2025-06-23 22:04:30,371 - src.optimizer - INFO - Gap improved by 2.97% to 50.38%
2025-06-23 22:04:30,388 - src.optimizer - INFO - Gap improved by 1.05% to 49.33%
2025-06-23 22:04:30,474 - src.optimizer - INFO - Gap improved by 1.32% to 47.76%
2025-06-23 22:04:32,715 - gurobipy - INFO - H 3951  2295                    1124.9746878  876.39510  22.1%  11.4    3s
2025-06-23 22:04:32,716 - src.optimizer - INFO - Gap improved by 10.73% to 28.36%
2025-06-23 22:04:33,006 - gurobipy - INFO - H 4055  2252                    1099.3747381  876.39510  20.3%  12.1    4s
2025-06-23 22:04:33,006 - src.optimizer - INFO - Gap improved by 2.92% to 25.44%
2025-06-23 22:04:33,007 - gurobipy - INFO - H 4058  2143                    1084.4415261  876.39510  19.2%  12.2    4s
2025-06-23 22:04:33,007 - src.optimizer - INFO - Gap improved by 1.70% to 23.74%
2025-06-23 22:04:33,111 - gurobipy - INFO - H 4153  2093                     979.6038886  876.39510  10.5%  12.6    4s
2025-06-23 22:04:33,111 - src.optimizer - INFO - Gap improved by 11.96% to 11.78%
2025-06-23 22:04:33,494 - gurobipy - INFO - * 4680  2086              31     974.1182374  885.17966  9.13%  14.7    4s
2025-06-23 22:04:33,495 - gurobipy - INFO - * 4687  1990              27     947.1819940  885.17966  6.55%  14.8    4s
2025-06-23 22:04:33,495 - src.optimizer - INFO - Gap improved by 3.04% to 7.00%
2025-06-23 22:04:33,496 - gurobipy - INFO - * 4689  1899              28     922.4963559  885.17966  4.05%  14.7    4s
2025-06-23 22:04:33,497 - src.optimizer - INFO - Gap improved by 2.79% to 4.22%
2025-06-23 22:04:33,578 - gurobipy - INFO - H 4809  1804                     913.9630606  885.24521  3.14%  15.1    4s
2025-06-23 22:04:33,975 - gurobipy - INFO -   5707   936  910.70247   32    4  913.96306  900.02410  1.53%  15.5    5s
2025-06-23 22:04:34,168 - gurobipy - INFO - 
2025-06-23 22:04:34,169 - gurobipy - INFO - Cutting planes:
2025-06-23 22:04:34,169 - gurobipy - INFO -   Gomory: 9
2025-06-23 22:04:34,169 - gurobipy - INFO -   Lift-and-project: 58
2025-06-23 22:04:34,169 - gurobipy - INFO -   Cover: 35
2025-06-23 22:04:34,169 - gurobipy - INFO -   MIR: 28
2025-06-23 22:04:34,169 - gurobipy - INFO -   Flow cover: 109
2025-06-23 22:04:34,169 - gurobipy - INFO -   GUB cover: 2
2025-06-23 22:04:34,169 - gurobipy - INFO -   Inf proof: 3
2025-06-23 22:04:34,169 - gurobipy - INFO -   Zero half: 69
2025-06-23 22:04:34,169 - gurobipy - INFO -   RLT: 27
2025-06-23 22:04:34,170 - gurobipy - INFO -   Lazy constraints: 64
2025-06-23 22:04:34,170 - gurobipy - INFO - 
2025-06-23 22:04:34,171 - gurobipy - INFO - Explored 5993 nodes (89289 simplex iterations) in 5.22 seconds (5.58 work units)
2025-06-23 22:04:34,171 - gurobipy - INFO - Thread count was 12 (of 12 available processors)
2025-06-23 22:04:34,171 - gurobipy - INFO - 
2025-06-23 22:04:34,171 - gurobipy - INFO - Solution count 10: 913.963 922.496 947.182 ... 1221.13
2025-06-23 22:04:34,171 - gurobipy - INFO - 
2025-06-23 22:04:34,171 - gurobipy - INFO - Optimal solution found (tolerance 1.00e-04)
2025-06-23 22:04:34,172 - gurobipy - INFO - Best objective 9.139630606095e+02, best bound 9.139630606095e+02, gap 0.0000%
2025-06-23 22:04:34,173 - gurobipy - INFO - 
2025-06-23 22:04:34,174 - gurobipy - INFO - User-callback calls 14392, time in user-callback 0.16 sec
2025-06-23 22:04:34,175 - src.optimizer - INFO - Optimization successful, selected 45 edges
2025-06-23 22:04:34,175 - src.optimizer - INFO - After optimization model solving - Memory usage: 434.73 MB
2025-06-23 22:04:34,175 - __main__ - INFO - After optimization - Memory usage: 434.73 MB
2025-06-23 22:04:34,177 - __main__ - INFO - Added starting node at the end to close the tour
2025-06-23 22:04:34,177 - __main__ - INFO - Saved tour path with 46 points to output/path/path.txt
2025-06-23 22:04:34,177 - __main__ - INFO - Tour visits 44 unique nodes with 45 total steps
2025-06-23 22:04:34,177 - __main__ - INFO - Tour includes 1 revisited nodes (tie points)
2025-06-23 22:04:34,177 - __main__ - INFO - Creating VRF heatmap with optimized path overlay
2025-06-23 22:04:34,177 - src.visualizer - INFO - Creating visibility heatmaps
2025-06-23 22:04:34,182 - src.visualizer - INFO - Edge visibility range: 0 to 13 segments
2025-06-23 22:04:35,988 - src.visualizer - INFO - Saved edge visibility heatmap to output/visibility_heatmaps/1_edge_visibility_heatmap_20250623_220434.png
2025-06-23 22:04:35,992 - src.visualizer - INFO - Segment visibility range: 0 to 73 edges
2025-06-23 22:04:37,158 - src.visualizer - INFO - Saved segment visibility heatmap to output/visibility_heatmaps/2_segment_visibility_heatmap_20250623_220436.png
2025-06-23 22:04:37,162 - src.visualizer - INFO - Edge VRF range: 0.0000 to 1.2500
2025-06-23 22:04:39,209 - src.visualizer - INFO - Saved edge VRF heatmap to output/visibility_heatmaps/3_edge_vrf_heatmap_20250623_220437.png
2025-06-23 22:04:39,213 - src.visualizer - INFO - VRF with path overlay - VRF range: 0.0000 to 1.2500
2025-06-23 22:04:39,675 - __main__ - ERROR - Error during execution: draw_networkx_nodes() got an unexpected keyword argument 'zorder'
Traceback (most recent call last):
  File "/home/mo/thesis/My_Thesis/Versions/thesis_v24/main.py", line 519, in main
    visualizer.create_visibility_heatmaps(G, building, obstacles, segments, edge_visibility, segment_visibility, vrf, selected_edges)
  File "/home/mo/thesis/My_Thesis/Versions/thesis_v24/src/visualizer.py", line 400, in create_visibility_heatmaps
    self._plot_vrf_with_optimized_path(G, building, obstacles, vrf, selected_edges, heatmaps_dir)
  File "/home/mo/thesis/My_Thesis/Versions/thesis_v24/src/visualizer.py", line 248, in _plot_vrf_with_optimized_path
    nx.draw_networkx_nodes(G, pos, node_color='lightgray', node_size=20,
TypeError: draw_networkx_nodes() got an unexpected keyword argument 'zorder'
2025-06-23 22:04:39,677 - src.visualizer - INFO - Creating visualization
2025-06-23 22:04:41,851 - src.visualizer - INFO - Saved plot to output/plots/result_plot_20250623_220439.png
2025-06-23 22:05:36,581 - __main__ - INFO - Disposed Gurobi optimization model
2025-06-23 22:05:36,582 - __main__ - INFO - Before cleanup - Memory usage: 490.01 MB
2025-06-23 22:05:36,658 - __main__ - INFO - After cleanup - Memory usage: 485.98 MB
