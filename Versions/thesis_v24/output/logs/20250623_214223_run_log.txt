2025-06-23 21:42:23,654 - __main__ - INFO - Starting visibility path planning with grid aligned to building orientation (debug enabled)
2025-06-23 21:42:23,660 - __main__ - INFO - Initial memory usage - Memory usage: 108.64 MB
2025-06-23 21:42:23,660 - __main__ - INFO - Loading geometry data
2025-06-23 21:42:23,660 - __main__ - INFO - Building orientation analysis is enabled
2025-06-23 21:42:23,661 - __main__ - INFO - Debug visualization is enabled
2025-06-23 21:42:23,661 - __main__ - INFO - Before geometry loading - Memory usage: 108.64 MB
2025-06-23 21:42:23,661 - src.data_handler - INFO - Loading geometries from data/geometry.json
2025-06-23 21:42:23,662 - src.data_handler - WARNING - Building building2 has an invalid polygon
2025-06-23 21:42:23,662 - src.data_handler - INFO - Building orientation analysis is enabled
2025-06-23 21:42:23,667 - src.rotation_utils - INFO - Longest edge length: 18.00, angle with north: 90.00 degrees
2025-06-23 21:42:23,667 - src.rotation_utils - INFO - Target angle: 90 degrees
2025-06-23 21:42:23,668 - src.rotation_utils - INFO - Rotation angle needed: 0.00 degrees (clockwise)
2025-06-23 21:42:23,668 - src.rotation_utils - INFO - Rotation center: (50.63920951381602, 26.90398740818468)
2025-06-23 21:42:23,761 - src.data_handler - INFO - Saved orientation information to output/orientation/orientation_info.json
2025-06-23 21:42:23,761 - src.data_handler - INFO - Building orientation: Longest edge at 90.00째, Target angle 90째
2025-06-23 21:42:23,761 - src.data_handler - INFO - Grid alignment: Will use rotation angle of 0.00째 around (50.63920951381602, 26.90398740818468)
2025-06-23 21:42:23,979 - __main__ - INFO - After geometry loading - Memory usage: 164.88 MB
2025-06-23 21:42:23,979 - __main__ - INFO - Building the graph
2025-06-23 21:42:23,979 - __main__ - INFO - Before graph building - Memory usage: 164.88 MB
2025-06-23 21:42:23,979 - src.graph_builder - INFO - Building grid graph
2025-06-23 21:42:23,979 - src.graph_builder - INFO - Grid will be aligned with building orientation (rotated by -0.00째)
2025-06-23 21:42:23,996 - src.graph_builder - INFO - Generated 193 grid points
2025-06-23 21:42:24,574 - src.graph_builder - WARNING - The generated graph is not connected.
2025-06-23 21:42:24,574 - src.graph_builder - INFO - Created graph with 193 nodes and 1704 edges
2025-06-23 21:42:24,574 - __main__ - INFO - After graph building - Memory usage: 165.62 MB
2025-06-23 21:42:24,574 - __main__ - INFO - Analyzing visibility with normal vector approach
2025-06-23 21:42:24,574 - __main__ - INFO - Before visibility analysis - Memory usage: 165.62 MB
2025-06-23 21:42:24,574 - src.visibility_analyzer - INFO - Using 12 CPU cores for visibility analysis
2025-06-23 21:42:24,574 - src.visibility_analyzer - INFO - Using touch threshold of 0.1 meters
2025-06-23 21:42:24,574 - src.visibility_analyzer - INFO - Analyzing visibility
2025-06-23 21:42:24,574 - src.visibility_analyzer - INFO - Before segment creation - Memory usage: 165.62 MB
2025-06-23 21:42:24,589 - src.visibility_analyzer - INFO - Created 90 building segments with normal vectors
2025-06-23 21:42:24,589 - src.visibility_analyzer - INFO - Calculating edge-segment visibility using normal vector approach (parallelized)
2025-06-23 21:42:24,589 - src.visibility_analyzer - INFO - Before edge-segment visibility calculation - Memory usage: 165.62 MB
2025-06-23 21:42:24,589 - src.visibility_analyzer - INFO - Dividing 90 segments into 12 chunks for parallel processing
2025-06-23 21:42:26,301 - src.visibility_analyzer - INFO - After edge-segment visibility calculation - Memory usage: 170.62 MB
2025-06-23 21:42:26,301 - src.visibility_analyzer - INFO - Calculating particle-based visibility using normal vector approach (parallelized)
2025-06-23 21:42:26,301 - src.visibility_analyzer - INFO - Before particle visibility calculation - Memory usage: 170.62 MB
2025-06-23 21:42:26,301 - src.visibility_analyzer - INFO - Dividing 1704 edges into 12 chunks for parallel processing
2025-06-23 21:43:00,563 - src.visibility_analyzer - INFO - After particle visibility calculation - Memory usage: 171.75 MB
2025-06-23 21:43:00,566 - src.visibility_analyzer - INFO - Saved segment visibility to output/visibility/segment_visibility.csv
2025-06-23 21:43:00,567 - src.visibility_analyzer - INFO - Saved edge visibility to output/visibility/edge_visibility.csv
2025-06-23 21:43:00,567 - __main__ - INFO - After visibility analysis - Memory usage: 171.75 MB
2025-06-23 21:43:00,567 - __main__ - INFO - Creating thesis plots
2025-06-23 21:43:00,567 - __main__ - INFO - Creating thesis plots
2025-06-23 21:43:00,567 - src.graph_builder - INFO - Building original (non-rotated) grid graph for thesis plots
2025-06-23 21:43:01,219 - src.graph_builder - WARNING - The generated graph is not connected.
2025-06-23 21:43:01,219 - src.graph_builder - INFO - Created original graph with 193 nodes and 1704 edges
2025-06-23 21:43:01,219 - src.graph_builder - INFO - Building rotated grid graph for thesis plots
2025-06-23 21:43:01,861 - src.graph_builder - WARNING - The generated graph is not connected.
2025-06-23 21:43:01,861 - src.graph_builder - INFO - Created rotated graph with 193 nodes and 1704 edges
2025-06-23 21:43:01,861 - src.visualizer - INFO - Creating thesis plots
2025-06-23 21:43:02,804 - src.visualizer - INFO - Saved thesis plot 1 to output/thesis_plots/1_building_obstacles_footprint_20250623_214301.png
2025-06-23 21:43:03,956 - src.visualizer - INFO - Saved thesis plot 2 to output/thesis_plots/2_building_with_segments_20250623_214302.png
2025-06-23 21:43:05,135 - src.visualizer - INFO - Saved thesis plot 3 to output/thesis_plots/3_building_original_graph_20250623_214303.png
2025-06-23 21:43:06,347 - src.visualizer - INFO - Saved thesis plot 4 to output/thesis_plots/4_building_rotated_graph_20250623_214305.png
2025-06-23 21:43:06,348 - __main__ - INFO - Creating visibility heatmaps (basic)
2025-06-23 21:43:06,348 - src.visualizer - INFO - Creating visibility heatmaps
2025-06-23 21:43:06,351 - src.visualizer - INFO - Edge visibility range: 0 to 7 segments
2025-06-23 21:43:08,061 - src.visualizer - INFO - Saved edge visibility heatmap to output/visibility_heatmaps/1_edge_visibility_heatmap_20250623_214306.png
2025-06-23 21:43:08,064 - src.visualizer - INFO - Segment visibility range: 0 to 52 edges
2025-06-23 21:43:09,271 - src.visualizer - INFO - Saved segment visibility heatmap to output/visibility_heatmaps/2_segment_visibility_heatmap_20250623_214308.png
2025-06-23 21:43:09,275 - src.visualizer - INFO - Edge VRF range: 0.0000 to 0.7500
2025-06-23 21:43:11,134 - src.visualizer - INFO - Saved edge VRF heatmap to output/visibility_heatmaps/3_edge_vrf_heatmap_20250623_214309.png
2025-06-23 21:43:11,135 - __main__ - INFO - Running path optimization
2025-06-23 21:43:11,135 - __main__ - INFO - Before optimization - Memory usage: 358.64 MB
2025-06-23 21:43:11,135 - __main__ - INFO - Running garbage collection before optimization
2025-06-23 21:43:11,196 - src.optimizer - INFO - Setting up optimization model
2025-06-23 21:43:11,196 - src.optimizer - INFO - Before optimization model creation - Memory usage: 208.41 MB
2025-06-23 21:43:11,197 - gurobipy - INFO - Set parameter Username
2025-06-23 21:43:11,197 - gurobipy - INFO - Set parameter LicenseID to value 2654881
2025-06-23 21:43:11,197 - gurobipy - INFO - Academic license - for non-commercial use only - expires 2026-04-21
2025-06-23 21:43:11,197 - gurobipy - INFO - Set parameter LazyConstraints to value 1
2025-06-23 21:43:11,198 - gurobipy - INFO - Set parameter MIPGap to value 0,0001
2025-06-23 21:43:11,203 - src.optimizer - WARNING - Segment 3 has no visible edges
2025-06-23 21:43:11,203 - src.optimizer - WARNING - Segment 14 has no visible edges
2025-06-23 21:43:11,203 - src.optimizer - WARNING - Segment 15 has no visible edges
2025-06-23 21:43:11,203 - src.optimizer - WARNING - Segment 18 has no visible edges
2025-06-23 21:43:11,203 - src.optimizer - WARNING - Segment 19 has no visible edges
2025-06-23 21:43:11,204 - src.optimizer - WARNING - Segment 22 has no visible edges
2025-06-23 21:43:11,204 - src.optimizer - WARNING - Segment 26 has no visible edges
2025-06-23 21:43:11,204 - src.optimizer - WARNING - Segment 29 has no visible edges
2025-06-23 21:43:11,204 - src.optimizer - WARNING - Segment 31 has no visible edges
2025-06-23 21:43:11,204 - src.optimizer - WARNING - Segment 34 has no visible edges
2025-06-23 21:43:11,204 - src.optimizer - WARNING - Segment 37 has no visible edges
2025-06-23 21:43:11,204 - src.optimizer - WARNING - Segment 38 has no visible edges
2025-06-23 21:43:11,204 - src.optimizer - WARNING - Segment 41 has no visible edges
2025-06-23 21:43:11,204 - src.optimizer - WARNING - Segment 42 has no visible edges
2025-06-23 21:43:11,211 - src.optimizer - INFO - Adding constraints for tie points: [95]
2025-06-23 21:43:11,211 - src.optimizer - INFO - Added tie point constraints for node 95
2025-06-23 21:43:11,211 - src.optimizer - INFO - Using original subtour elimination constraints
2025-06-23 21:43:12,904 - src.optimizer - INFO - Added 156832 subtour elimination constraints
2025-06-23 21:43:12,905 - src.optimizer - INFO - After optimization model setup - Memory usage: 228.41 MB
2025-06-23 21:43:12,905 - src.optimizer - INFO - Solving optimization model with progress monitoring
2025-06-23 21:43:12,922 - gurobipy - INFO - Gurobi Optimizer version 12.0.1 build v12.0.1rc0 (linux64 - "Ubuntu 22.04.5 LTS")
2025-06-23 21:43:12,922 - gurobipy - INFO - 
2025-06-23 21:43:12,922 - gurobipy - INFO - CPU model: 12th Gen Intel(R) Core(TM) i5-12450H, instruction set [SSE2|AVX|AVX2]
2025-06-23 21:43:12,922 - gurobipy - INFO - Thread count: 12 physical cores, 12 logical processors, using up to 12 threads
2025-06-23 21:43:12,922 - gurobipy - INFO - 
2025-06-23 21:43:12,922 - gurobipy - INFO - Non-default parameters:
2025-06-23 21:43:12,923 - gurobipy - INFO - LazyConstraints  1
2025-06-23 21:43:12,923 - gurobipy - INFO - 
2025-06-23 21:43:12,923 - gurobipy - INFO - Optimize a model with 157103 rows, 1704 columns and 331327 nonzeros
2025-06-23 21:43:12,924 - gurobipy - INFO - Model fingerprint: 0x23b3c748
2025-06-23 21:43:12,924 - gurobipy - INFO - Variable types: 0 continuous, 1704 integer (1704 binary)
2025-06-23 21:43:12,925 - gurobipy - INFO - Coefficient statistics:
2025-06-23 21:43:12,925 - gurobipy - INFO -   Matrix range     [1e+00, 1e+00]
2025-06-23 21:43:12,925 - gurobipy - INFO -   Objective range  [1e+01, 2e+07]
2025-06-23 21:43:12,925 - gurobipy - INFO -   Bounds range     [1e+00, 1e+00]
2025-06-23 21:43:12,925 - gurobipy - INFO -   RHS range        [1e+00, 2e+00]
2025-06-23 21:43:12,956 - gurobipy - INFO - Presolve removed 152125 rows and 0 columns
2025-06-23 21:43:12,956 - gurobipy - INFO - Presolve time: 0.02s
2025-06-23 21:43:12,956 - gurobipy - INFO - Presolved: 4978 rows, 1704 columns, 27079 nonzeros
2025-06-23 21:43:12,958 - gurobipy - INFO - Variable types: 0 continuous, 1704 integer (1704 binary)
2025-06-23 21:43:12,963 - gurobipy - INFO - Performing another presolve...
2025-06-23 21:43:12,985 - gurobipy - INFO - Presolve removed 18 rows and 0 columns
2025-06-23 21:43:12,985 - gurobipy - INFO - Presolve time: 0.02s
2025-06-23 21:43:12,996 - gurobipy - INFO - 
2025-06-23 21:43:12,996 - gurobipy - INFO - Root relaxation: objective 5.450652e+02, 72 iterations, 0.00 seconds (0.00 work units)
2025-06-23 21:43:13,001 - gurobipy - INFO - 
2025-06-23 21:43:13,001 - gurobipy - INFO -     Nodes    |    Current Node    |     Objective Bounds      |     Work
2025-06-23 21:43:13,001 - gurobipy - INFO -  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
2025-06-23 21:43:13,001 - gurobipy - INFO - 
2025-06-23 21:43:13,001 - gurobipy - INFO -      0     0  545.06523    0   56          -  545.06523      -     -    0s
2025-06-23 21:43:13,027 - gurobipy - INFO -      0     0  762.82927    0   66          -  762.82927      -     -    0s
2025-06-23 21:43:13,041 - gurobipy - INFO -      0     0  978.75292    0   25          -  978.75292      -     -    0s
2025-06-23 21:43:13,046 - gurobipy - INFO -      0     0  979.33957    0   30          -  979.33957      -     -    0s
2025-06-23 21:43:13,061 - gurobipy - INFO -      0     0 1019.73058    0   18          - 1019.73058      -     -    0s
2025-06-23 21:43:13,066 - gurobipy - INFO -      0     0 1021.86391    0   20          - 1021.86391      -     -    0s
2025-06-23 21:43:13,079 - gurobipy - INFO -      0     0 1033.24157    0   21          - 1033.24157      -     -    0s
2025-06-23 21:43:13,084 - gurobipy - INFO -      0     0 1033.24160    0   22          - 1033.24160      -     -    0s
2025-06-23 21:43:13,091 - gurobipy - INFO -      0     0 1036.79714    0   30          - 1036.79714      -     -    0s
2025-06-23 21:43:13,096 - gurobipy - INFO -      0     0 1039.55794    0   32          - 1039.55794      -     -    0s
2025-06-23 21:43:13,098 - gurobipy - INFO -      0     0 1039.55794    0   32          - 1039.55794      -     -    0s
2025-06-23 21:43:13,105 - gurobipy - INFO -      0     0 1041.83957    0   37          - 1041.83957      -     -    0s
2025-06-23 21:43:13,115 - gurobipy - INFO -      0     0 1041.83958    0   33          - 1041.83958      -     -    0s
2025-06-23 21:43:13,125 - gurobipy - INFO -      0     0 1041.97811    0   37          - 1041.97811      -     -    0s
2025-06-23 21:43:13,134 - gurobipy - INFO -      0     0 1043.04478    0   44          - 1043.04478      -     -    0s
2025-06-23 21:43:13,141 - gurobipy - INFO -      0     0 1044.11145    0   45          - 1044.11145      -     -    0s
2025-06-23 21:43:13,150 - gurobipy - INFO -      0     0 1044.11145    0   50          - 1044.11145      -     -    0s
2025-06-23 21:43:13,175 - gurobipy - INFO -      0     0 1051.73048    0   49          - 1051.73048      -     -    0s
2025-06-23 21:43:13,184 - gurobipy - INFO -      0     0 1055.34948    0   57          - 1055.34948      -     -    0s
2025-06-23 21:43:13,188 - gurobipy - INFO -      0     0 1057.82568    0   59          - 1057.82568      -     -    0s
2025-06-23 21:43:13,197 - gurobipy - INFO -      0     0 1059.65428    0   54          - 1059.65428      -     -    0s
2025-06-23 21:43:13,200 - gurobipy - INFO -      0     0 1059.65428    0   55          - 1059.65428      -     -    0s
2025-06-23 21:43:13,209 - gurobipy - INFO -      0     0 1059.67772    0   54          - 1059.67772      -     -    0s
2025-06-23 21:43:13,219 - gurobipy - INFO -      0     0 1059.77618    0   54          - 1059.77618      -     -    0s
2025-06-23 21:43:13,230 - gurobipy - INFO -      0     0 1060.28412    0   53          - 1060.28412      -     -    0s
2025-06-23 21:43:13,306 - gurobipy - INFO -      0     2 1061.75709    0   62          - 1061.75709      -     -    0s
2025-06-23 21:43:17,735 - src.optimizer - INFO - Optimization progress: 0.00% gap after 4.8 seconds
2025-06-23 21:43:17,735 - src.optimizer - INFO - Gap improved by inf% to 0.00%
2025-06-23 21:43:17,735 - gurobipy - INFO - * 4031  3459              25    1522.2793977 1522.27940  0.00%   8.7    4s
2025-06-23 21:43:17,736 - gurobipy - INFO - 
2025-06-23 21:43:17,736 - gurobipy - INFO - Cutting planes:
2025-06-23 21:43:17,736 - gurobipy - INFO -   Gomory: 7
2025-06-23 21:43:17,736 - gurobipy - INFO -   Lift-and-project: 47
2025-06-23 21:43:17,736 - gurobipy - INFO -   Cover: 25
2025-06-23 21:43:17,736 - gurobipy - INFO -   MIR: 28
2025-06-23 21:43:17,736 - gurobipy - INFO -   Flow cover: 77
2025-06-23 21:43:17,736 - gurobipy - INFO -   Zero half: 41
2025-06-23 21:43:17,736 - gurobipy - INFO -   RLT: 17
2025-06-23 21:43:17,736 - gurobipy - INFO -   Lazy constraints: 4
2025-06-23 21:43:17,738 - gurobipy - INFO - 
2025-06-23 21:43:17,738 - gurobipy - INFO - Explored 4031 nodes (37297 simplex iterations) in 4.82 seconds (5.96 work units)
2025-06-23 21:43:17,738 - gurobipy - INFO - Thread count was 12 (of 12 available processors)
2025-06-23 21:43:17,738 - gurobipy - INFO - 
2025-06-23 21:43:17,738 - gurobipy - INFO - Solution count 1: 1522.28 
2025-06-23 21:43:17,738 - gurobipy - INFO - 
2025-06-23 21:43:17,738 - gurobipy - INFO - Optimal solution found (tolerance 1.00e-04)
2025-06-23 21:43:17,739 - gurobipy - INFO - Best objective 1.522279397691e+03, best bound 1.522279397691e+03, gap 0.0000%
2025-06-23 21:43:17,741 - gurobipy - INFO - 
2025-06-23 21:43:17,741 - gurobipy - INFO - User-callback calls 11086, time in user-callback 0.09 sec
2025-06-23 21:43:17,743 - src.optimizer - INFO - Optimization successful, selected 52 edges
2025-06-23 21:43:17,743 - src.optimizer - INFO - After optimization model solving - Memory usage: 430.41 MB
2025-06-23 21:43:17,743 - __main__ - INFO - After optimization - Memory usage: 430.41 MB
2025-06-23 21:43:17,744 - __main__ - INFO - Added starting node at the end to close the tour
2025-06-23 21:43:17,744 - __main__ - INFO - Saved tour path with 53 points to output/path/path.txt
2025-06-23 21:43:17,744 - __main__ - INFO - Tour visits 50 unique nodes with 52 total steps
2025-06-23 21:43:17,744 - __main__ - INFO - Tour includes 2 revisited nodes (tie points)
2025-06-23 21:43:17,744 - __main__ - INFO - Creating VRF heatmap with optimized path overlay
2025-06-23 21:43:17,744 - src.visualizer - INFO - Creating visibility heatmaps
2025-06-23 21:43:17,748 - src.visualizer - INFO - Edge visibility range: 0 to 7 segments
2025-06-23 21:43:19,443 - src.visualizer - INFO - Saved edge visibility heatmap to output/visibility_heatmaps/1_edge_visibility_heatmap_20250623_214318.png
2025-06-23 21:43:19,447 - src.visualizer - INFO - Segment visibility range: 0 to 52 edges
2025-06-23 21:43:20,598 - src.visualizer - INFO - Saved segment visibility heatmap to output/visibility_heatmaps/2_segment_visibility_heatmap_20250623_214319.png
2025-06-23 21:43:20,602 - src.visualizer - INFO - Edge VRF range: 0.0000 to 0.7500
2025-06-23 21:43:22,544 - src.visualizer - INFO - Saved edge VRF heatmap to output/visibility_heatmaps/3_edge_vrf_heatmap_20250623_214321.png
2025-06-23 21:43:22,548 - src.visualizer - INFO - VRF with path overlay - VRF range: 0.0000 to 0.7500
2025-06-23 21:43:22,990 - __main__ - ERROR - Error during execution: draw_networkx_nodes() got an unexpected keyword argument 'zorder'
Traceback (most recent call last):
  File "/home/mo/thesis/My_Thesis/Versions/thesis_v24/main.py", line 519, in main
    visualizer.create_visibility_heatmaps(G, building, obstacles, segments, edge_visibility, segment_visibility, vrf, selected_edges)
  File "/home/mo/thesis/My_Thesis/Versions/thesis_v24/src/visualizer.py", line 400, in create_visibility_heatmaps
    self._plot_vrf_with_optimized_path(G, building, obstacles, vrf, selected_edges, heatmaps_dir)
  File "/home/mo/thesis/My_Thesis/Versions/thesis_v24/src/visualizer.py", line 248, in _plot_vrf_with_optimized_path
    nx.draw_networkx_nodes(G, pos, node_color='lightgray', node_size=20,
TypeError: draw_networkx_nodes() got an unexpected keyword argument 'zorder'
2025-06-23 21:43:22,991 - src.visualizer - INFO - Creating visualization
2025-06-23 21:43:25,158 - src.visualizer - INFO - Saved plot to output/plots/result_plot_20250623_214323.png
2025-06-23 21:44:15,380 - __main__ - INFO - Disposed Gurobi optimization model
2025-06-23 21:44:15,380 - __main__ - INFO - Before cleanup - Memory usage: 481.24 MB
2025-06-23 21:44:15,461 - __main__ - INFO - After cleanup - Memory usage: 473.30 MB
