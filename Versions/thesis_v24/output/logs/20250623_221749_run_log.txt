2025-06-23 22:17:49,004 - __main__ - INFO - Starting visibility path planning with normal vector approach
2025-06-23 22:17:49,010 - __main__ - INFO - Initial memory usage - Memory usage: 108.81 MB
2025-06-23 22:17:49,010 - __main__ - INFO - Loading geometry data
2025-06-23 22:17:49,011 - __main__ - INFO - Building orientation analysis is disabled
2025-06-23 22:17:49,011 - __main__ - INFO - Before geometry loading - Memory usage: 108.81 MB
2025-06-23 22:17:49,011 - src.data_handler - INFO - Loading geometries from data/geometry.json
2025-06-23 22:17:49,012 - src.data_handler - WARNING - Building building2 has an invalid polygon
2025-06-23 22:17:49,012 - src.data_handler - INFO - Building orientation analysis is disabled
2025-06-23 22:17:49,013 - __main__ - INFO - After geometry loading - Memory usage: 109.93 MB
2025-06-23 22:17:49,013 - __main__ - INFO - Building the graph
2025-06-23 22:17:49,013 - __main__ - INFO - Before graph building - Memory usage: 109.93 MB
2025-06-23 22:17:49,013 - src.graph_builder - INFO - Building grid graph
2025-06-23 22:17:49,042 - src.graph_builder - INFO - Generated 193 grid points
2025-06-23 22:17:49,642 - src.graph_builder - WARNING - The generated graph is not connected.
2025-06-23 22:17:49,642 - src.graph_builder - INFO - Created graph with 193 nodes and 1700 edges
2025-06-23 22:17:49,642 - __main__ - INFO - After graph building - Memory usage: 110.93 MB
2025-06-23 22:17:49,642 - __main__ - INFO - Analyzing visibility with normal vector approach
2025-06-23 22:17:49,642 - __main__ - INFO - Before visibility analysis - Memory usage: 110.93 MB
2025-06-23 22:17:49,642 - src.visibility_analyzer - INFO - Using 12 CPU cores for visibility analysis
2025-06-23 22:17:49,642 - src.visibility_analyzer - INFO - Using touch threshold of 0.1 meters
2025-06-23 22:17:49,642 - src.visibility_analyzer - INFO - Analyzing visibility
2025-06-23 22:17:49,642 - src.visibility_analyzer - INFO - Before segment creation - Memory usage: 110.93 MB
2025-06-23 22:17:49,657 - src.visibility_analyzer - INFO - Created 85 building segments with normal vectors
2025-06-23 22:17:49,657 - src.visibility_analyzer - INFO - Calculating edge-segment visibility using normal vector approach (parallelized)
2025-06-23 22:17:49,657 - src.visibility_analyzer - INFO - Before edge-segment visibility calculation - Memory usage: 110.93 MB
2025-06-23 22:17:49,657 - src.visibility_analyzer - INFO - Dividing 85 segments into 12 chunks for parallel processing
2025-06-23 22:17:51,456 - src.visibility_analyzer - INFO - After edge-segment visibility calculation - Memory usage: 115.43 MB
2025-06-23 22:17:51,456 - src.visibility_analyzer - INFO - Calculating particle-based visibility using normal vector approach (parallelized)
2025-06-23 22:17:51,456 - src.visibility_analyzer - INFO - Before particle visibility calculation - Memory usage: 115.43 MB
2025-06-23 22:17:51,456 - src.visibility_analyzer - INFO - Dividing 1700 edges into 12 chunks for parallel processing
2025-06-23 22:18:25,761 - src.visibility_analyzer - INFO - After particle visibility calculation - Memory usage: 116.18 MB
2025-06-23 22:18:25,764 - src.visibility_analyzer - INFO - Saved segment visibility to output/visibility/segment_visibility.csv
2025-06-23 22:18:25,765 - src.visibility_analyzer - INFO - Saved edge visibility to output/visibility/edge_visibility.csv
2025-06-23 22:18:25,766 - __main__ - INFO - After visibility analysis - Memory usage: 116.31 MB
2025-06-23 22:18:25,766 - __main__ - INFO - Creating thesis plots
2025-06-23 22:18:25,766 - __main__ - INFO - Creating thesis plots
2025-06-23 22:18:25,766 - src.graph_builder - INFO - Building original (non-rotated) grid graph for thesis plots
2025-06-23 22:18:26,429 - src.graph_builder - WARNING - The generated graph is not connected.
2025-06-23 22:18:26,429 - src.graph_builder - INFO - Created original graph with 193 nodes and 1700 edges
2025-06-23 22:18:26,429 - src.visualizer - INFO - Creating thesis plots
2025-06-23 22:18:27,410 - src.visualizer - INFO - Saved thesis plot 1 to output/thesis_plots/1_building_obstacles_footprint_20250623_221826.png
2025-06-23 22:18:28,543 - src.visualizer - INFO - Saved thesis plot 2 to output/thesis_plots/2_building_with_segments_20250623_221827.png
2025-06-23 22:18:29,695 - src.visualizer - INFO - Saved thesis plot 3 to output/thesis_plots/3_building_original_graph_20250623_221828.png
2025-06-23 22:18:29,695 - __main__ - INFO - Creating visibility heatmaps (basic)
2025-06-23 22:18:29,695 - src.visualizer - INFO - Creating visibility heatmaps
2025-06-23 22:18:29,699 - src.visualizer - INFO - Edge visibility range: 0 to 10 segments
2025-06-23 22:18:31,356 - src.visualizer - INFO - Saved edge visibility heatmap to output/visibility_heatmaps/1_edge_visibility_heatmap_20250623_221830.png
2025-06-23 22:18:31,359 - src.visualizer - INFO - Segment visibility range: 0 to 66 edges
2025-06-23 22:18:32,433 - src.visualizer - INFO - Saved segment visibility heatmap to output/visibility_heatmaps/2_segment_visibility_heatmap_20250623_221831.png
2025-06-23 22:18:32,437 - src.visualizer - INFO - Edge VRF range: 0.0000 to 1.0000
2025-06-23 22:18:34,264 - src.visualizer - INFO - Saved edge VRF heatmap to output/visibility_heatmaps/3_edge_vrf_heatmap_20250623_221832.png
2025-06-23 22:18:34,264 - __main__ - INFO - Running path optimization
2025-06-23 22:18:34,264 - __main__ - INFO - Before optimization - Memory usage: 338.79 MB
2025-06-23 22:18:34,264 - __main__ - INFO - Running garbage collection before optimization
2025-06-23 22:18:34,321 - src.optimizer - INFO - Setting up optimization model
2025-06-23 22:18:34,321 - src.optimizer - INFO - Before optimization model creation - Memory usage: 188.55 MB
2025-06-23 22:18:34,322 - gurobipy - INFO - Set parameter Username
2025-06-23 22:18:34,322 - gurobipy - INFO - Set parameter LicenseID to value 2654881
2025-06-23 22:18:34,322 - gurobipy - INFO - Academic license - for non-commercial use only - expires 2026-04-21
2025-06-23 22:18:34,323 - gurobipy - INFO - Set parameter LazyConstraints to value 1
2025-06-23 22:18:34,323 - gurobipy - INFO - Set parameter MIPGap to value 0,0001
2025-06-23 22:18:34,328 - src.optimizer - WARNING - Segment 6 has no visible edges
2025-06-23 22:18:34,328 - src.optimizer - WARNING - Segment 13 has no visible edges
2025-06-23 22:18:34,328 - src.optimizer - WARNING - Segment 14 has no visible edges
2025-06-23 22:18:34,329 - src.optimizer - WARNING - Segment 24 has no visible edges
2025-06-23 22:18:34,329 - src.optimizer - WARNING - Segment 27 has no visible edges
2025-06-23 22:18:34,329 - src.optimizer - WARNING - Segment 29 has no visible edges
2025-06-23 22:18:34,329 - src.optimizer - WARNING - Segment 31 has no visible edges
2025-06-23 22:18:34,329 - src.optimizer - WARNING - Segment 38 has no visible edges
2025-06-23 22:18:34,335 - src.optimizer - INFO - Adding constraints for tie points: [94]
2025-06-23 22:18:34,336 - src.optimizer - INFO - Added tie point constraints for node 94
2025-06-23 22:18:34,336 - src.optimizer - INFO - Using original subtour elimination constraints
2025-06-23 22:18:35,961 - src.optimizer - INFO - Added 156472 subtour elimination constraints
2025-06-23 22:18:35,961 - src.optimizer - INFO - After optimization model setup - Memory usage: 210.80 MB
2025-06-23 22:18:35,962 - src.optimizer - INFO - Solving optimization model with progress monitoring
2025-06-23 22:18:35,979 - gurobipy - INFO - Gurobi Optimizer version 12.0.1 build v12.0.1rc0 (linux64 - "Ubuntu 22.04.5 LTS")
2025-06-23 22:18:35,979 - gurobipy - INFO - 
2025-06-23 22:18:35,979 - gurobipy - INFO - CPU model: 12th Gen Intel(R) Core(TM) i5-12450H, instruction set [SSE2|AVX|AVX2]
2025-06-23 22:18:35,979 - gurobipy - INFO - Thread count: 12 physical cores, 12 logical processors, using up to 12 threads
2025-06-23 22:18:35,979 - gurobipy - INFO - 
2025-06-23 22:18:35,979 - gurobipy - INFO - Non-default parameters:
2025-06-23 22:18:35,979 - gurobipy - INFO - LazyConstraints  1
2025-06-23 22:18:35,979 - gurobipy - INFO - 
2025-06-23 22:18:35,979 - gurobipy - INFO - Optimize a model with 156744 rows, 1700 columns and 330751 nonzeros
2025-06-23 22:18:35,980 - gurobipy - INFO - Model fingerprint: 0x6a3e9c8b
2025-06-23 22:18:35,980 - gurobipy - INFO - Variable types: 0 continuous, 1700 integer (1700 binary)
2025-06-23 22:18:35,981 - gurobipy - INFO - Coefficient statistics:
2025-06-23 22:18:35,981 - gurobipy - INFO -   Matrix range     [1e+00, 1e+00]
2025-06-23 22:18:35,981 - gurobipy - INFO -   Objective range  [8e+00, 2e+07]
2025-06-23 22:18:35,981 - gurobipy - INFO -   Bounds range     [1e+00, 1e+00]
2025-06-23 22:18:35,981 - gurobipy - INFO -   RHS range        [1e+00, 2e+00]
2025-06-23 22:18:36,011 - gurobipy - INFO - Presolve removed 151786 rows and 0 columns
2025-06-23 22:18:36,011 - gurobipy - INFO - Presolve time: 0.02s
2025-06-23 22:18:36,012 - gurobipy - INFO - Presolved: 4958 rows, 1700 columns, 27183 nonzeros
2025-06-23 22:18:36,013 - gurobipy - INFO - Variable types: 0 continuous, 1700 integer (1700 binary)
2025-06-23 22:18:36,018 - gurobipy - INFO - Performing another presolve...
2025-06-23 22:18:36,040 - gurobipy - INFO - Presolve removed 22 rows and 0 columns
2025-06-23 22:18:36,040 - gurobipy - INFO - Presolve time: 0.02s
2025-06-23 22:18:36,053 - gurobipy - INFO - 
2025-06-23 22:18:36,053 - gurobipy - INFO - Root relaxation: objective 5.210654e+02, 67 iterations, 0.00 seconds (0.00 work units)
2025-06-23 22:18:36,058 - gurobipy - INFO - 
2025-06-23 22:18:36,058 - gurobipy - INFO -     Nodes    |    Current Node    |     Objective Bounds      |     Work
2025-06-23 22:18:36,058 - gurobipy - INFO -  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
2025-06-23 22:18:36,058 - gurobipy - INFO - 
2025-06-23 22:18:36,058 - gurobipy - INFO -      0     0  521.06537    0   54          -  521.06537      -     -    0s
2025-06-23 22:18:36,085 - gurobipy - INFO -      0     0  798.16893    0   72          -  798.16893      -     -    0s
2025-06-23 22:18:36,091 - gurobipy - INFO -      0     0  810.16894    0   76          -  810.16894      -     -    0s
2025-06-23 22:18:36,093 - gurobipy - INFO -      0     0  810.16894    0   76          -  810.16894      -     -    0s
2025-06-23 22:18:36,107 - gurobipy - INFO -      0     0  932.37614    0   97          -  932.37614      -     -    0s
2025-06-23 22:18:36,110 - gurobipy - INFO -      0     0  939.58880    0   87          -  939.58880      -     -    0s
2025-06-23 22:18:36,113 - gurobipy - INFO -      0     0  940.46498    0   89          -  940.46498      -     -    0s
2025-06-23 22:18:36,139 - gurobipy - INFO -      0     0 1004.45456    0   78          - 1004.45456      -     -    0s
2025-06-23 22:18:36,142 - gurobipy - INFO -      0     0 1005.74979    0   74          - 1005.74979      -     -    0s
2025-06-23 22:18:36,145 - gurobipy - INFO -      0     0 1005.74979    0   74          - 1005.74979      -     -    0s
2025-06-23 22:18:36,166 - gurobipy - INFO -      0     0 1011.73075    0   46          - 1011.73075      -     -    0s
2025-06-23 22:18:36,171 - gurobipy - INFO -      0     0 1012.44186    0   46          - 1012.44186      -     -    0s
2025-06-23 22:18:36,181 - gurobipy - INFO -      0     0 1013.13073    0   45          - 1013.13073      -     -    0s
2025-06-23 22:18:36,186 - gurobipy - INFO -      0     0 1013.43740    0   48          - 1013.43740      -     -    0s
2025-06-23 22:18:36,196 - gurobipy - INFO -      0     0 1013.78788    0   48          - 1013.78788      -     -    0s
2025-06-23 22:18:36,201 - gurobipy - INFO -      0     0 1013.78788    0   48          - 1013.78788      -     -    0s
2025-06-23 22:18:36,210 - gurobipy - INFO -      0     0 1013.90640    0   54          - 1013.90640      -     -    0s
2025-06-23 22:18:36,221 - gurobipy - INFO -      0     0 1014.82924    0   54          - 1014.82924      -     -    0s
2025-06-23 22:18:36,270 - gurobipy - INFO -      0     2 1019.23961    0   52          - 1019.23961      -     -    0s
2025-06-23 22:18:36,740 - gurobipy - INFO - * 1834  1739             104    2976.8928687 1033.57198  65.3%   9.5    0s
2025-06-23 22:18:36,740 - src.optimizer - INFO - Optimization progress: 188.02% gap after 0.8 seconds
2025-06-23 22:18:36,740 - src.optimizer - INFO - Gap improved by inf% to 188.02%
2025-06-23 22:18:36,773 - gurobipy - INFO - H 1936  1731                    2614.2287517 1033.57198  60.5%   9.4    0s
2025-06-23 22:18:36,774 - gurobipy - INFO - H 1936  1723                    2588.6288073 1033.57198  60.1%   9.4    0s
2025-06-23 22:18:36,774 - src.optimizer - INFO - Gap improved by 37.57% to 150.45%
2025-06-23 22:18:36,775 - gurobipy - INFO - H 1955  1563                    1953.4383436 1033.57198  47.1%   9.4    0s
2025-06-23 22:18:36,776 - gurobipy - INFO - H 1955  1480                    1762.5063555 1033.57198  41.4%   9.4    0s
2025-06-23 22:18:36,776 - src.optimizer - INFO - Gap improved by 79.93% to 70.53%
2025-06-23 22:18:36,849 - gurobipy - INFO - H 2120  1423                    1549.1745886 1034.18148  33.2%   9.5    0s
2025-06-23 22:18:36,849 - src.optimizer - INFO - Gap improved by 20.63% to 49.80%
2025-06-23 22:18:36,908 - gurobipy - INFO - H 2330  1517                    1545.9745952 1034.18148  33.1%   9.5    0s
2025-06-23 22:18:37,000 - src.optimizer - INFO - Gap improved by 1.86% to 47.63%
2025-06-23 22:18:37,008 - src.optimizer - INFO - Gap improved by 3.49% to 44.13%
2025-06-23 22:18:37,039 - src.optimizer - INFO - Gap improved by 5.89% to 37.77%
2025-06-23 22:18:37,082 - src.optimizer - INFO - Gap improved by 2.43% to 34.61%
2025-06-23 22:18:37,139 - src.optimizer - INFO - Gap improved by 2.05% to 31.91%
2025-06-23 22:18:37,219 - src.optimizer - INFO - Gap improved by 1.19% to 29.88%
2025-06-23 22:18:37,300 - src.optimizer - INFO - Gap improved by 1.07% to 28.70%
2025-06-23 22:18:37,318 - gurobipy - INFO - H 2363  1456                    1424.3751744 1201.18906  15.7%   9.4    1s
2025-06-23 22:18:37,319 - src.optimizer - INFO - Gap improved by 10.12% to 18.58%
2025-06-23 22:18:37,525 - src.optimizer - INFO - Gap improved by 2.22% to 15.31%
2025-06-23 22:18:39,279 - gurobipy - INFO - H 2490  1460                    1424.3751690 1304.67865  8.40%   8.9    3s
2025-06-23 22:18:39,282 - gurobipy - INFO - H 2490  1384                    1424.3751612 1304.67865  8.40%   8.9    3s
2025-06-23 22:18:41,023 - gurobipy - INFO -   2649  1492 1345.14911   35  217 1424.37516 1345.14911  5.56%  11.1    5s
2025-06-23 22:18:42,180 - gurobipy - INFO - H 2783  1495                    1424.3747628 1353.43589  4.98%  13.6    6s
2025-06-23 22:18:43,095 - gurobipy - INFO - * 4342  1411              32    1421.6323453 1382.43347  2.76%  19.4    7s
2025-06-23 22:18:43,674 - gurobipy - INFO - 
2025-06-23 22:18:43,675 - gurobipy - INFO - Cutting planes:
2025-06-23 22:18:43,675 - gurobipy - INFO -   Gomory: 10
2025-06-23 22:18:43,676 - gurobipy - INFO -   Lift-and-project: 7
2025-06-23 22:18:43,676 - gurobipy - INFO -   Cover: 31
2025-06-23 22:18:43,676 - gurobipy - INFO -   MIR: 32
2025-06-23 22:18:43,676 - gurobipy - INFO -   Flow cover: 101
2025-06-23 22:18:43,677 - gurobipy - INFO -   GUB cover: 4
2025-06-23 22:18:43,677 - gurobipy - INFO -   Inf proof: 7
2025-06-23 22:18:43,677 - gurobipy - INFO -   Zero half: 70
2025-06-23 22:18:43,677 - gurobipy - INFO -   RLT: 39
2025-06-23 22:18:43,677 - gurobipy - INFO -   Lazy constraints: 12
2025-06-23 22:18:43,681 - gurobipy - INFO - 
2025-06-23 22:18:43,682 - gurobipy - INFO - Explored 6474 nodes (129989 simplex iterations) in 7.70 seconds (8.10 work units)
2025-06-23 22:18:43,682 - gurobipy - INFO - Thread count was 12 (of 12 available processors)
2025-06-23 22:18:43,682 - gurobipy - INFO - 
2025-06-23 22:18:43,682 - gurobipy - INFO - Solution count 10: 1421.63 1424.37 1424.38 ... 2614.23
2025-06-23 22:18:43,682 - gurobipy - INFO - 
2025-06-23 22:18:43,682 - gurobipy - INFO - Optimal solution found (tolerance 1.00e-04)
2025-06-23 22:18:43,684 - gurobipy - INFO - Best objective 1.421632345301e+03, best bound 1.421632345301e+03, gap 0.0000%
2025-06-23 22:18:43,685 - gurobipy - INFO - 
2025-06-23 22:18:43,685 - gurobipy - INFO - User-callback calls 17085, time in user-callback 0.11 sec
2025-06-23 22:18:43,687 - src.optimizer - INFO - Optimization successful, selected 50 edges
2025-06-23 22:18:43,687 - src.optimizer - INFO - After optimization model solving - Memory usage: 425.11 MB
2025-06-23 22:18:43,687 - __main__ - INFO - After optimization - Memory usage: 425.11 MB
2025-06-23 22:18:43,688 - __main__ - INFO - Saved tour path with 42 points to output/path/path.txt
2025-06-23 22:18:43,688 - __main__ - INFO - Tour visits 41 unique nodes with 42 total steps
2025-06-23 22:18:43,688 - __main__ - INFO - Tour includes 1 revisited nodes (tie points)
2025-06-23 22:18:43,688 - __main__ - INFO - Creating VRF heatmap with optimized path overlay
2025-06-23 22:18:43,688 - src.visualizer - INFO - Creating visibility heatmaps
2025-06-23 22:18:43,692 - src.visualizer - INFO - Edge visibility range: 0 to 10 segments
2025-06-23 22:18:45,374 - src.visualizer - INFO - Saved edge visibility heatmap to output/visibility_heatmaps/1_edge_visibility_heatmap_20250623_221844.png
2025-06-23 22:18:45,378 - src.visualizer - INFO - Segment visibility range: 0 to 66 edges
2025-06-23 22:18:46,470 - src.visualizer - INFO - Saved segment visibility heatmap to output/visibility_heatmaps/2_segment_visibility_heatmap_20250623_221845.png
2025-06-23 22:18:46,474 - src.visualizer - INFO - Edge VRF range: 0.0000 to 1.0000
2025-06-23 22:18:48,413 - src.visualizer - INFO - Saved edge VRF heatmap to output/visibility_heatmaps/3_edge_vrf_heatmap_20250623_221847.png
2025-06-23 22:18:48,417 - src.visualizer - INFO - VRF with path overlay - VRF range: 0.0000 to 1.0000
2025-06-23 22:18:48,860 - __main__ - ERROR - Error during execution: draw_networkx_nodes() got an unexpected keyword argument 'zorder'
Traceback (most recent call last):
  File "/home/mo/thesis/My_Thesis/Versions/thesis_v24/main.py", line 519, in main
    visualizer.create_visibility_heatmaps(G, building, obstacles, segments, edge_visibility, segment_visibility, vrf, selected_edges)
  File "/home/mo/thesis/My_Thesis/Versions/thesis_v24/src/visualizer.py", line 400, in create_visibility_heatmaps
    self._plot_vrf_with_optimized_path(G, building, obstacles, vrf, selected_edges, heatmaps_dir)
  File "/home/mo/thesis/My_Thesis/Versions/thesis_v24/src/visualizer.py", line 248, in _plot_vrf_with_optimized_path
    nx.draw_networkx_nodes(G, pos, node_color='lightgray', node_size=20,
TypeError: draw_networkx_nodes() got an unexpected keyword argument 'zorder'
2025-06-23 22:18:48,862 - src.visualizer - INFO - Creating visualization
2025-06-23 22:18:51,009 - src.visualizer - INFO - Saved plot to output/plots/result_plot_20250623_221848.png
2025-06-23 22:19:28,037 - __main__ - WARNING - Received interrupt signal, stopping gracefully and showing current results
2025-06-23 22:19:28,040 - src.visualizer - INFO - Creating visualization
2025-06-23 22:19:28,203 - __main__ - WARNING - Received interrupt signal, stopping gracefully and showing current results
2025-06-23 22:19:28,204 - src.visualizer - INFO - Creating visualization
2025-06-23 22:19:30,301 - src.visualizer - INFO - Saved plot to output/plots/result_plot_20250623_221928.png
2025-06-23 22:19:33,965 - __main__ - INFO - Before cleanup - Memory usage: 533.61 MB
2025-06-23 22:19:34,095 - __main__ - INFO - After cleanup - Memory usage: 525.55 MB
2025-06-23 22:19:34,112 - __main__ - INFO - Disposed Gurobi optimization model
2025-06-23 22:19:34,112 - __main__ - INFO - Before cleanup - Memory usage: 518.56 MB
2025-06-23 22:19:34,218 - __main__ - INFO - After cleanup - Memory usage: 518.56 MB
